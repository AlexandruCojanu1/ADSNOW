{
  "articles": [
    {
      "title": "${escapeHTML(article.title)}",
      "date": "2025-12-16",
      "category": null,
      "excerpt": null,
      "image": null,
      "content": "// Admin Panel functionality\n(function() {\n  'use strict';\n  \n  const ADMIN_PASSWORD = 'adsnow2025'; // Change this to your desired password\n  const ARTICLES_FILE = 'data/blog/articles.json';\n  const GITHUB_API_BASE = 'https://api.github.com';\n  \n  // GitHub configuration (stored in localStorage with defaults)\n  const DEFAULT_GITHUB_REPO = 'AlexandruCojanu1/ADSNOW';\n  const DEFAULT_GITHUB_BRANCH = 'main';\n  \n  // CodeMirror editor instance\n  let codeEditor = null;\n  \n  function getGitHubConfig() {\n    // Initialize defaults if not set\n    if (!localStorage.getItem('github_repo')) {\n      localStorage.setItem('github_repo', DEFAULT_GITHUB_REPO);\n    }\n    if (!localStorage.getItem('github_branch')) {\n      localStorage.setItem('github_branch', DEFAULT_GITHUB_BRANCH);\n    }\n    \n    // Token will be set automatically when user opens Settings for the first time\n    \n    return {\n      token: localStorage.getItem('github_token') || '',\n      repo: localStorage.getItem('github_repo') || DEFAULT_GITHUB_REPO,\n      branch: localStorage.getItem('github_branch') || DEFAULT_GITHUB_BRANCH\n    };\n  }\n  \n  function saveGitHubConfig(config) {\n    if (config.token) localStorage.setItem('github_token', config.token);\n    if (config.repo) localStorage.setItem('github_repo', config.repo);\n    if (config.branch) localStorage.setItem('github_branch', config.branch);\n  }\n  \n  // Check authentication\n  function isAuthenticated() {\n    return sessionStorage.getItem('admin_authenticated') === 'true';\n  }\n  \n  // Set authentication\n  function setAuthenticated(value) {\n    sessionStorage.setItem('admin_authenticated', value ? 'true' : 'false');\n  }\n  \n  // Show/hide screens\n  function showLogin() {\n    const loginScreen = document.getElementById('login-screen');\n    const adminPanel = document.getElementById('admin-panel');\n    if (loginScreen) loginScreen.style.display = 'flex';\n    if (adminPanel) adminPanel.style.display = 'none';\n    // Clear password field\n    const passwordInput = document.getElementById('admin-password');\n    if (passwordInput) passwordInput.value = '';\n  }\n  \n  function showAdmin() {\n    const loginScreen = document.getElementById('login-screen');\n    const adminPanel = document.getElementById('admin-panel');\n    if (loginScreen) loginScreen.style.display = 'none';\n    if (adminPanel) adminPanel.style.display = 'block';\n  }\n  \n  // Reset session (for debugging)\n  function resetSession() {\n    sessionStorage.removeItem('admin_authenticated');\n    showLogin();\n  }\n  \n  // Login handler\n  function handleLogin(e) {\n    e.preventDefault();\n    const passwordInput = document.getElementById('admin-password');\n    const password = passwordInput.value.trim();\n    const errorDiv = document.getElementById('login-error');\n    \n    // Clear any previous errors\n    errorDiv.style.display = 'none';\n    errorDiv.textContent = '';\n    \n    if (!password) {\n      errorDiv.textContent = 'Te rog introdu parola';\n      errorDiv.style.display = 'block';\n      return;\n    }\n    \n    // Debug logging (remove in production)\n    console.log('Login attempt - password length:', password.length);\n    \n    if (password === ADMIN_PASSWORD) {\n      console.log('Login successful');\n      setAuthenticated(true);\n      showAdmin();\n      loadArticles();\n      // Initialize editor after login\n      setTimeout(initCodeEditor, 100);\n      passwordInput.value = '';\n    } else {\n      console.log('Login failed - password mismatch');\n      errorDiv.textContent = 'ParolƒÉ incorectƒÉ. Te rog √ÆncearcƒÉ din nou.';\n      errorDiv.style.display = 'block';\n      passwordInput.value = '';\n      passwordInput.focus();\n    }\n  }\n  \n  // Logout handler\n  function handleLogout() {\n    setAuthenticated(false);\n    showLogin();\n  }\n  \n  // Generate slug from title\n  function generateSlug(title) {\n    return title\n      .toLowerCase()\n      .normalize('NFD')\n      .replace(/[\\u0300-\\u036f]/g, '')\n      .replace(/[^a-z0-9]+/g, '-')\n      .replace(/(^-|-$)/g, '');\n  }\n  \n  // Convert plain text to formatted HTML\n  function textToHTML(text) {\n    if (!text) return '';\n    \n    // Split by double newlines (paragraphs)\n    const paragraphs = text.split(/\\n\\s*\\n/).filter(p => p.trim());\n    \n    return paragraphs.map(para => {\n      const lines = para.split('\\n').map(l => l.trim()).filter(l => l);\n      \n      // Check if it's a list\n      if (lines.length > 0 && (lines[0].startsWith('- ') || lines[0].startsWith('* '))) {\n        const listItems = lines\n          .filter(line => line.startsWith('- ') || line.startsWith('* '))\n          .map(line => line.replace(/^[-*]\\s+/, ''));\n        \n        if (listItems.length > 0) {\n          return `<ul>${listItems.map(item => `<li>${escapeHTML(item)}</li>`).join('')}</ul>`;\n        }\n      }\n      \n      // Check if it's a heading (lines that are short and all caps or have specific patterns)\n      const firstLine = lines[0];\n      if (firstLine && firstLine.length < 100 && (\n        firstLine === firstLine.toUpperCase() && firstLine.length > 3 && firstLine.length < 50\n      )) {\n        return `<h2>${escapeHTML(firstLine)}</h2>${lines.slice(1).map(l => `<p>${escapeHTML(l)}</p>`).join('')}`;\n      }\n      \n      // Regular paragraph - join lines with <br> if multiple lines, otherwise just <p>\n      if (lines.length === 1) {\n        return `<p>${formatInlineText(lines[0])}</p>`;\n      } else {\n        return `<p>${lines.map(l => formatInlineText(l)).join('<br>')}</p>`;\n      }\n    }).join('');\n  }\n  \n  // Simple HTML escape\n  function escapeHTML(text) {\n    const div = document.createElement('div');\n    div.textContent = text;\n    return div.innerHTML;\n  }\n  \n  // Format inline text (links, bold, italic)\n  function formatInlineText(text) {\n    // First escape HTML\n    let formatted = escapeHTML(text);\n    \n    // Convert **bold** to <strong> first (before italic)\n    formatted = formatted.replace(/\\*\\*(.+?)\\*\\*/g, '<strong>$1</strong>');\n    \n    // Convert *italic* to <em> (only single * that's not part of **)\n    // Match *text* but not **text** by checking the original text\n    const originalText = text;\n    formatted = formatted.replace(/\\*([^*\\n]+?)\\*/g, function(match, content, offset) {\n      // Check in original text if this is part of **bold**\n      const origBefore = originalText.substring(Math.max(0, offset - 1), offset);\n      const origAfter = originalText.substring(offset + match.length, offset + match.length + 1);\n      if (origBefore === '*' || origAfter === '*') {\n        return match; // Don't convert, it's part of bold\n      }\n      return '<em>' + content + '</em>';\n    });\n    \n    // Auto-detect and convert URLs to links (after formatting)\n    const urlRegex = /(https?:\\/\\/[^\\s<>\"']+)/g;\n    formatted = formatted.replace(urlRegex, '<a href=\"$1\" target=\"_blank\" rel=\"noopener\">$1</a>');\n    \n    return formatted;\n  }\n  \n  // Load articles from JSON\n  async function loadArticles() {\n    const listDiv = document.getElementById('articles-list');\n    if (!listDiv) return;\n    \n    try {\n      const config = getGitHubConfig();\n      let data = { articles: [] };\n      \n      if (config.token) {\n        // Load from GitHub\n        try {\n          const fileData = await getGitHubFile(ARTICLES_FILE);\n          if (fileData) {\n            data = JSON.parse(fileData.content);\n            console.log('Loaded articles from GitHub:', data.articles.length);\n          } else {\n            console.log('No articles file found on GitHub');\n          }\n        } catch (error) {\n          console.warn('Could not load from GitHub, trying local:', error);\n          // Fallback to local\n          try {\n            const response = await fetch(ARTICLES_FILE);\n            if (response.ok) {\n              data = await response.json();\n              console.log('Loaded articles from local:', data.articles.length);\n            }\n          } catch (localError) {\n            console.error('Could not load from local either:', localError);\n          }\n        }\n      } else {\n        // Load from local\n        try {\n          const response = await fetch(ARTICLES_FILE);\n          if (response.ok) {\n            data = await response.json();\n            console.log('Loaded articles from local:', data.articles.length);\n          }\n        } catch (error) {\n          console.error('Error loading articles from local:', error);\n        }\n      }\n      \n      const articles = data.articles || [];\n      \n      // Sort by date (newest first)\n      articles.sort((a, b) => new Date(b.date) - new Date(a.date));\n      \n      if (articles.length === 0) {\n        listDiv.innerHTML = '<p style=\"color: #2E5E99; font-family: var(--font-sans);\">Nu existƒÉ articole publicate √ÆncƒÉ.</p>';\n        return;\n      }\n      \n      // Store articles globally for reference\n      window._articlesList = articles;\n      \n      listDiv.innerHTML = articles.map((article, index) => {\n        const date = new Date(article.date).toLocaleDateString('ro-RO');\n        const slug = article.slug || generateSlug(article.title);\n        return `\n          <div class=\"article-item\">\n            <div class=\"article-item-info\">\n              <div class=\"article-item-title\">${article.title}</div>\n              <div class=\"article-item-meta\">${date} ${article.category ? '‚Ä¢ ' + article.category : ''}</div>\n            </div>\n            <div class=\"article-item-actions\">\n              <button class=\"admin-button admin-button-secondary\" onclick=\"deleteArticleBySlug('${slug}')\">»òterge</button>\n            </div>\n          </div>\n        `;\n      }).join('');\n      \n    } catch (error) {\n      console.error('Error loading articles:', error);\n      listDiv.innerHTML = '<p style=\"color: #c00; font-family: var(--font-sans);\">Eroare la √ÆncƒÉrcarea articolelor: ' + error.message + '</p>';\n    }\n  }\n  \n  // GitHub API: Get file content\n  async function getGitHubFile(path) {\n    const config = getGitHubConfig();\n    if (!config.token) {\n      throw new Error('GitHub token nu este configurat. AcceseazƒÉ SetƒÉri pentru a-l configura.');\n    }\n    \n    const url = `${GITHUB_API_BASE}/repos/${config.repo}/contents/${path}?ref=${config.branch}`;\n    const response = await fetch(url, {\n      headers: {\n        'Authorization': `token ${config.token}`,\n        'Accept': 'application/vnd.github.v3+json'\n      }\n    });\n    \n    if (!response.ok) {\n      if (response.status === 404) {\n        return null; // File doesn't exist\n      }\n      throw new Error(`GitHub API error: ${response.status} ${response.statusText}`);\n    }\n    \n    const data = await response.json();\n    return {\n      content: atob(data.content.replace(/\\s/g, '')),\n      sha: data.sha\n    };\n  }\n  \n  // GitHub API: Update or create file\n  async function updateGitHubFile(path, content, sha, message) {\n    const config = getGitHubConfig();\n    if (!config.token) {\n      throw new Error('GitHub token nu este configurat.');\n    }\n    \n    const url = `${GITHUB_API_BASE}/repos/${config.repo}/contents/${path}`;\n    const body = {\n      message: message,\n      content: btoa(unescape(encodeURIComponent(content))),\n      branch: config.branch\n    };\n    \n    // Only include SHA if file exists (for updates)\n    // For new files, don't include SHA (undefined or null means new file)\n    if (sha !== null && sha !== undefined && sha !== '') {\n      body.sha = sha;\n    }\n    \n    const response = await fetch(url, {\n      method: 'PUT',\n      headers: {\n        'Authorization': `token ${config.token}`,\n        'Accept': 'application/vnd.github.v3+json',\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify(body)\n    });\n    \n    if (!response.ok) {\n      const errorData = await response.json().catch(() => ({}));\n      const errorMessage = errorData.message || errorData.error || response.statusText;\n      throw new Error(`GitHub API error: ${response.status} - ${errorMessage}`);\n    }\n    \n    return await response.json();\n  }\n  \n  // Generate sitemap.xml from articles\n  function generateSitemap(articles) {\n    const today = new Date().toISOString().split('T')[0];\n    \n    let sitemap = `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<urlset xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">\n  <url>\n    <loc>https://www.adsnow.ro/</loc>\n    <lastmod>${today}</lastmod>\n    <changefreq>weekly</changefreq>\n    <priority>1.0</priority>\n  </url>\n  <url>\n    <loc>https://www.adsnow.ro/blog</loc>\n    <lastmod>${today}</lastmod>\n    <changefreq>daily</changefreq>\n    <priority>0.8</priority>\n  </url>`;\n    \n    // Add each blog post URL\n    articles.forEach(article => {\n      const slug = article.slug || generateSlug(article.title);\n      const articleDate = article.date ? new Date(article.date).toISOString().split('T')[0] : today;\n      sitemap += `\n  <url>\n    <loc>https://www.adsnow.ro/blog/${slug}</loc>\n    <lastmod>${articleDate}</lastmod>\n    <changefreq>monthly</changefreq>\n    <priority>0.7</priority>\n  </url>`;\n    });\n    \n    sitemap += `\n</urlset>`;\n    \n    return sitemap;\n  }\n  \n  // Update sitemap.xml on GitHub\n  async function updateSitemap(articles) {\n    try {\n      const config = getGitHubConfig();\n      if (!config.token) {\n        console.warn('GitHub token not configured, skipping sitemap update');\n        return;\n      }\n      \n      const sitemapContent = generateSitemap(articles);\n      \n      // Get current sitemap SHA if it exists\n      let sitemapSha = null;\n      try {\n        const existingSitemap = await getGitHubFile('sitemap.xml');\n        if (existingSitemap) {\n          sitemapSha = existingSitemap.sha;\n        }\n      } catch (error) {\n        // File doesn't exist, that's fine - we'll create it\n        console.log('Sitemap.xml does not exist, will create new file');\n      }\n      \n      // Update sitemap.xml\n      await updateGitHubFile(\n        'sitemap.xml',\n        sitemapContent,\n        sitemapSha || undefined,\n        'Update sitemap.xml with new blog posts'\n      );\n      \n      console.log('‚úÖ Sitemap.xml updated successfully!');\n    } catch (error) {\n      console.error('Error updating sitemap.xml:', error);\n      // Don't throw - sitemap update failure shouldn't break article publishing\n    }\n  }\n  \n  // Notify Google Indexing API about a new/updated URL\n  async function notifyGoogleIndexing(url) {\n    try {\n      // Determine the API endpoint - use current domain for production, or relative path for local dev\n      const apiEndpoint = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'\n        ? '/api/index-google'\n        : `${window.location.origin}/api/index-google`;\n      \n      console.log('üöÄ Notifying Google Indexing API:', url);\n      console.log('   Endpoint:', apiEndpoint);\n      \n      const response = await fetch(apiEndpoint, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ url: url })\n      });\n      \n      const result = await response.json();\n      \n      if (response.ok && result.success) {\n        console.log('‚úÖ Google Indexing API notified successfully:', result);\n        return true;\n      } else {\n        console.warn('‚ö†Ô∏è Google Indexing API returned error:', result);\n        // Don't throw - indexing failure shouldn't break article publishing\n        return false;\n      }\n    } catch (error) {\n      console.warn('‚ö†Ô∏è Failed to notify Google Indexing API:', error.message);\n      // Don't throw - indexing failure shouldn't break article publishing\n      // This allows articles to be published even if Google Indexing API is temporarily unavailable\n      return false;\n    }\n  }\n  \n  // Generate blog post HTML\n  function generateBlogPostHTML(article) {\n    const formattedDate = new Date(article.date).toLocaleDateString('ro-RO', { \n      year: 'numeric', \n      month: 'long', \n      day: 'numeric' \n    });\n    \n    const imageUrl = article.image ? (article.image.startsWith('http') ? article.image : `../${article.image}`) : null;\n    \n    return `<!doctype html>\n<html lang=\"ro\">\n  <head>\n    <meta charset=\"utf-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <title>${escapeHTML(article.title)} | ALGO DIGITAL SOLUTIONS</title>\n    <meta name=\"description\" content=\"${escapeHTML(article.excerpt || article.title)}\">\n    \n    <link rel=\"preconnect\" href=\"https://fonts.cdnfonts.com\">\n    <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\">\n    <link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap\" rel=\"stylesheet\">\n    <link rel=\"icon\" type=\"image/jpeg\" href=\"../assets/images/favicon.jpeg\">\n    \n    <link rel=\"stylesheet\" href=\"../css/variables.css?v=5\">\n    <link rel=\"stylesheet\" href=\"../css/base.css?v=4\">\n    <link rel=\"stylesheet\" href=\"../css/pill-nav.css?v=9\">\n    <link rel=\"stylesheet\" href=\"../css/blog.css?v=1\">\n    <link rel=\"stylesheet\" href=\"../css/responsive.css?v=21\">\n  </head>\n  \n  <body>\n    <div class=\"pill-nav-container\">\n      <nav class=\"pill-nav\" aria-label=\"Primary\">\n        <a class=\"pill-logo\" href=\"/\" aria-label=\"Home\">\n          <img src=\"../assets/images/favicon.jpeg\" alt=\"ALGO DIGITAL SOLUTIONS\">\n        </a>\n        \n        <div class=\"pill-nav-items desktop-only\">\n          <ul class=\"pill-list\" role=\"menubar\">\n            <li role=\"none\">\n              <a role=\"menuitem\" href=\"/#why\" class=\"pill\" aria-label=\"De ce ADSNOW\">\n                <span class=\"hover-circle\" aria-hidden=\"true\"></span>\n                <span class=\"label-stack\">\n                  <span class=\"pill-label\">De ce</span>\n                  <span class=\"pill-label-hover\" aria-hidden=\"true\">De ce</span>\n                </span>\n              </a>\n            </li>\n            <li role=\"none\">\n              <a role=\"menuitem\" href=\"/#steps\" class=\"pill\" aria-label=\"Etapele\">\n                <span class=\"hover-circle\" aria-hidden=\"true\"></span>\n                <span class=\"label-stack\">\n                  <span class=\"pill-label\">Etapele</span>\n                  <span class=\"pill-label-hover\" aria-hidden=\"true\">Etapele</span>\n                </span>\n              </a>\n            </li>\n            <li role=\"none\">\n              <a role=\"menuitem\" href=\"/#about\" class=\"pill\" aria-label=\"Despre noi\">\n                <span class=\"hover-circle\" aria-hidden=\"true\"></span>\n                <span class=\"label-stack\">\n                  <span class=\"pill-label\">Despre</span>\n                  <span class=\"pill-label-hover\" aria-hidden=\"true\">Despre</span>\n                </span>\n              </a>\n            </li>\n            <li role=\"none\">\n              <a role=\"menuitem\" href=\"/#contact\" class=\"pill\" aria-label=\"Contact\">\n                <span class=\"hover-circle\" aria-hidden=\"true\"></span>\n                <span class=\"label-stack\">\n                  <span class=\"pill-label\">Contact</span>\n                  <span class=\"pill-label-hover\" aria-hidden=\"true\">Contact</span>\n                </span>\n              </a>\n            </li>\n            <li role=\"none\">\n              <a role=\"menuitem\" href=\"/blog\" class=\"pill\" aria-label=\"Blog\">\n                <span class=\"hover-circle\" aria-hidden=\"true\"></span>\n                <span class=\"label-stack\">\n                  <span class=\"pill-label\">Blog</span>\n                  <span class=\"pill-label-hover\" aria-hidden=\"true\">Blog</span>\n                </span>\n              </a>\n            </li>\n          </ul>\n        </div>\n        \n        <button class=\"mobile-menu-button mobile-only\" aria-label=\"Toggle menu\" aria-expanded=\"false\" aria-controls=\"mobile-menu\">\n          <span class=\"hamburger-line\"></span>\n          <span class=\"hamburger-line\"></span>\n        </button>\n      </nav>\n      \n      <div id=\"mobile-menu\" class=\"mobile-menu-popover mobile-only\">\n        <ul class=\"mobile-menu-list\">\n          <li><a href=\"/#why\" class=\"mobile-menu-link\">De ce ADSNOW</a></li>\n          <li><a href=\"/#steps\" class=\"mobile-menu-link\">Etapele</a></li>\n          <li><a href=\"/#about\" class=\"mobile-menu-link\">Despre noi</a></li>\n          <li><a href=\"/#contact\" class=\"mobile-menu-link\">Contact</a></li>\n          <li><a href=\"/blog\" class=\"mobile-menu-link\">Blog</a></li>\n        </ul>\n      </div>\n    </div>\n\n    <section class=\"blog-post-section\">\n      <div class=\"blog-post-container\">\n        <article class=\"blog-post\">\n          <header class=\"blog-post-header\">\n            <div class=\"blog-post-meta\">\n              <span class=\"blog-card-date\">${formattedDate}</span>\n              ${article.category ? `<span class=\"blog-card-category\">${escapeHTML(article.category)}</span>` : ''}\n            </div>\n            <h1 class=\"blog-post-title\">${escapeHTML(article.title)}</h1>\n            ${imageUrl ? `<img src=\"${imageUrl}\" alt=\"${escapeHTML(article.title)}\" class=\"blog-post-image\">` : ''}\n          </header>\n          <div class=\"blog-post-content\">${article.content}</div>\n          <footer class=\"blog-post-footer\">\n            <a href=\"/blog\" class=\"blog-back-link\">‚Üê √énapoi la blog</a>\n          </footer>\n        </article>\n      </div>\n    </section>\n\n    <script src=\"https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js\" defer></script>\n    <script src=\"../js/pill-nav.js\" defer></script>\n  </body>\n</html>`;\n  }\n  \n  // Save article\n  async function saveArticle(articleData) {\n    try {\n      const config = getGitHubConfig();\n      \n      // Check if GitHub is configured\n      if (!config.token) {\n        // Fallback to download method\n        return saveArticleFallback(articleData);\n      }\n      \n      showMessage('Se salveazƒÉ articolul pe GitHub...', 'success');\n      \n      // Retry logic for handling SHA conflicts\n      let retries = 8; // Increased retries\n      let lastError = null;\n      let success = false;\n      \n      while (retries > 0 && !success) {\n        try {\n          // Always reload fresh data from GitHub before saving (critical for SHA)\n          let data = { articles: [] };\n          let articlesSha = null;\n          \n          try {\n            const fileData = await getGitHubFile(ARTICLES_FILE);\n            if (fileData) {\n              data = JSON.parse(fileData.content);\n              articlesSha = fileData.sha;\n              console.log(`[Attempt ${9 - retries}/8] Loaded fresh SHA:`, articlesSha.substring(0, 8) + '...');\n            } else {\n              console.log('No existing articles file, will create new one');\n            }\n          } catch (error) {\n            if (error.message.includes('404')) {\n              console.log('Articles file does not exist, will create new one');\n            } else {\n              console.warn('Could not load existing articles:', error);\n            }\n          }\n          \n          // Check if article already exists (avoid duplicates)\n          const slug = generateSlug(articleData.title);\n          const existingIndex = data.articles.findIndex(a => (a.slug || generateSlug(a.title)) === slug);\n          if (existingIndex !== -1) {\n            // Article already exists, update it instead\n            data.articles[existingIndex] = {\n              ...articleData,\n              slug: slug\n            };\n            console.log('Article already exists, updating...');\n          } else {\n            // Add new article\n            const newArticle = {\n              ...articleData,\n              slug: slug\n            };\n            data.articles.push(newArticle);\n            console.log('Adding new article...');\n          }\n          \n          // Save articles.json to GitHub\n          const jsonStr = JSON.stringify(data, null, 2);\n          await updateGitHubFile(\n            ARTICLES_FILE,\n            jsonStr,\n            articlesSha || undefined, // Use undefined instead of null for new files\n            `Add blog post: ${articleData.title}`\n          );\n          \n          // Success - break out of retry loop\n          success = true;\n          console.log('‚úÖ Article saved successfully!');\n          \n        } catch (error) {\n          lastError = error;\n          const is409 = error.message.includes('409');\n          console.error(`[Attempt ${9 - retries}/8] Failed:`, error.message, is409 ? '(SHA conflict)' : '');\n          \n          if (is409 && retries > 1) {\n            // SHA conflict - wait longer and retry with fresh SHA\n            // Progressive backoff: 1s, 2s, 3s, 4s, 5s, 6s, 7s\n            const waitTime = (9 - retries) * 1000;\n            console.log(`‚è≥ SHA conflict detected, waiting ${waitTime}ms before retry...`);\n            await new Promise(resolve => setTimeout(resolve, waitTime));\n            retries--;\n          } else {\n            // Non-409 error or last retry - throw immediately\n            throw error;\n          }\n        }\n      }\n      \n      if (!success && lastError) {\n        throw lastError;\n      }\n      \n      // Reload fresh data for blog post HTML generation\n      let data = { articles: [] };\n      try {\n        const fileData = await getGitHubFile(ARTICLES_FILE);\n        if (fileData) {\n          data = JSON.parse(fileData.content);\n        }\n      } catch (error) {\n        console.warn('Could not reload articles:', error);\n      }\n      \n      const slug = generateSlug(articleData.title);\n      const newArticle = data.articles.find(a => (a.slug || generateSlug(a.title)) === slug) || {\n        ...articleData,\n        slug: slug\n      };\n      \n      // Generate and save blog post HTML with retry logic\n      const blogPostHTML = generateBlogPostHTML(newArticle);\n      let blogPostSuccess = false;\n      let blogPostRetries = 5;\n      \n      while (blogPostRetries > 0 && !blogPostSuccess) {\n        try {\n          // Check if blog post HTML already exists\n          let blogPostSha = null;\n          try {\n            const existingBlogPost = await getGitHubFile(`blog/${slug}.html`);\n            if (existingBlogPost) {\n              blogPostSha = existingBlogPost.sha;\n              console.log('Blog post HTML exists, will update with SHA:', blogPostSha.substring(0, 8) + '...');\n            }\n          } catch (error) {\n            // File doesn't exist, that's fine - we'll create it\n            console.log('Blog post HTML does not exist, will create new file');\n          }\n          \n          await updateGitHubFile(\n            `blog/${slug}.html`,\n            blogPostHTML,\n            blogPostSha || undefined, // Use undefined instead of null\n            `Add blog post page: ${articleData.title}`\n          );\n          \n          blogPostSuccess = true;\n          console.log('‚úÖ Blog post HTML saved successfully!');\n          \n        } catch (error) {\n          const is409 = error.message.includes('409');\n          console.error(`[HTML Save Attempt ${6 - blogPostRetries}/5] Failed:`, error.message, is409 ? '(SHA conflict)' : '');\n          \n          if (is409 && blogPostRetries > 1) {\n            const waitTime = (6 - blogPostRetries) * 1000;\n            console.log(`‚è≥ SHA conflict on HTML save, waiting ${waitTime}ms before retry...`);\n            await new Promise(resolve => setTimeout(resolve, waitTime));\n            blogPostRetries--;\n          } else {\n            // Log error but don't fail the entire operation\n            console.warn('‚ö†Ô∏è Could not save blog post HTML, but article was saved:', error);\n            break;\n          }\n        }\n      }\n      \n      // Update sitemap.xml with all articles (including the new one)\n      try {\n        const fileData = await getGitHubFile(ARTICLES_FILE);\n        if (fileData) {\n          const allArticles = JSON.parse(fileData.content);\n          await updateSitemap(allArticles.articles || []);\n        }\n      } catch (error) {\n        console.warn('Could not update sitemap:', error);\n      }\n      \n      // Notify Google Indexing API about the new article\n      const articleSlug = generateSlug(articleData.title);\n      const articleUrl = `https://www.adsnow.ro/blog/${articleSlug}`;\n      await notifyGoogleIndexing(articleUrl);\n      \n      showMessage('‚úÖ Articolul a fost publicat cu succes pe GitHub! Sitemap-ul a fost actualizat »ôi Google a fost notificat. Vercel va redeploya automat √Æn c√¢teva secunde.', 'success');\n      \n      // Reload articles list from GitHub (wait a bit for GitHub to process)\n      setTimeout(async () => {\n        try {\n          await loadArticles();\n        } catch (error) {\n          console.error('Error reloading articles:', error);\n          // Try again after a bit more time\n          setTimeout(() => loadArticles(), 2000);\n        }\n      }, 1500);\n      \n      // Reset form\n      document.getElementById('article-form').reset();\n      // Reset editor\n      setEditorValue('<h1>Titlul articolului</h1>\\n<p>Scrie con»õinutul HTML aici...</p>');\n      \n    } catch (error) {\n      console.error('Error saving article:', error);\n      showMessage('Eroare la salvarea articolului: ' + error.message, 'error');\n    }\n  }\n  \n  // Fallback: Save article locally (download)\n  async function saveArticleFallback(articleData) {\n    try {\n      const response = await fetch(ARTICLES_FILE);\n      let data = { articles: [] };\n      \n      if (response.ok) {\n        data = await response.json();\n      }\n      \n      const slug = generateSlug(articleData.title);\n      const newArticle = {\n        ...articleData,\n        slug: slug\n      };\n      \n      data.articles.push(newArticle);\n      const jsonStr = JSON.stringify(data, null, 2);\n      \n      const blob = new Blob([jsonStr], { type: 'application/json' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = 'articles.json';\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      URL.revokeObjectURL(url);\n      \n      localStorage.setItem('blog_articles_backup', jsonStr);\n      \n      showMessage(\n        'Articolul a fost salvat local! ConfigureazƒÉ GitHub Token √Æn SetƒÉri pentru publicare automatƒÉ.',\n        'success'\n      );\n      \n      setTimeout(() => {\n        loadArticles();\n      }, 1000);\n      \n      document.getElementById('article-form').reset();\n      document.getElementById('article-date').value = new Date().toISOString().split('T')[0];\n      \n    } catch (error) {\n      console.error('Error saving article:', error);\n      showMessage('Eroare la salvarea articolului: ' + error.message, 'error');\n    }\n  }\n  \n  // Delete article by slug (more reliable than index)\n  window.deleteArticleBySlug = async function(slug) {\n    if (!confirm('E»ôti sigur cƒÉ vrei sƒÉ »ôtergi acest articol?')) {\n      return;\n    }\n    \n    try {\n      const config = getGitHubConfig();\n      \n      if (config.token) {\n        // Delete from GitHub\n        await deleteArticleFromGitHubBySlug(slug);\n      } else {\n        // Fallback to local\n        await deleteArticleLocalBySlug(slug);\n      }\n    } catch (error) {\n      console.error('Error deleting article:', error);\n      showMessage('Eroare la »ôtergerea articolului: ' + error.message, 'error');\n    }\n  };\n  \n  // Legacy function for backward compatibility\n  window.deleteArticle = window.deleteArticleBySlug;\n  \n  // Delete article from GitHub by slug\n  async function deleteArticleFromGitHubBySlug(slug) {\n    // Retry logic for handling SHA conflicts\n    let retries = 8;\n    let lastError = null;\n    let success = false;\n    \n    while (retries > 0 && !success) {\n      try {\n        // Always reload fresh data from GitHub before deleting\n        const fileData = await getGitHubFile(ARTICLES_FILE);\n        if (!fileData) {\n          throw new Error('Nu s-au gƒÉsit articole.');\n        }\n        \n        const data = JSON.parse(fileData.content);\n        const articleIndex = data.articles.findIndex(a => (a.slug || generateSlug(a.title)) === slug);\n        \n        if (articleIndex === -1) {\n          throw new Error('Articolul nu a fost gƒÉsit.');\n        }\n        \n        const article = data.articles[articleIndex];\n        data.articles.splice(articleIndex, 1);\n        \n        // Update articles.json with fresh SHA\n        const jsonStr = JSON.stringify(data, null, 2);\n        await updateGitHubFile(\n          ARTICLES_FILE,\n          jsonStr,\n          fileData.sha, // Use fresh SHA\n          `Delete blog post: ${article.title}`\n        );\n        \n        // Success - break out of retry loop\n        success = true;\n        console.log('‚úÖ Article deleted successfully!');\n        \n      } catch (error) {\n        lastError = error;\n        const is409 = error.message.includes('409');\n        console.error(`[Delete Attempt ${9 - retries}/8] Failed:`, error.message, is409 ? '(SHA conflict)' : '');\n        \n        if (is409 && retries > 1) {\n          // SHA conflict - wait longer and retry with fresh SHA\n          // Progressive backoff: 1s, 2s, 3s, 4s, 5s, 6s, 7s\n          const waitTime = (9 - retries) * 1000;\n          console.log(`‚è≥ SHA conflict on delete, waiting ${waitTime}ms before retry...`);\n          await new Promise(resolve => setTimeout(resolve, waitTime));\n          retries--;\n        } else {\n          // Non-409 error or last retry - throw immediately\n          throw error;\n        }\n      }\n    }\n    \n    if (!success && lastError) {\n      throw lastError;\n    }\n    \n    // Get article info for HTML deletion\n    const fileData = await getGitHubFile(ARTICLES_FILE);\n    const data = fileData ? JSON.parse(fileData.content) : { articles: [] };\n    const article = data.articles.find(a => (a.slug || generateSlug(a.title)) === slug);\n    \n    // Try to delete blog post HTML file (optional - may fail if file doesn't exist)\n    try {\n      const blogFileData = await getGitHubFile(`blog/${slug}.html`);\n      if (blogFileData) {\n        // Delete by updating with empty content and same SHA\n        const articleTitle = article ? article.title : slug;\n        await updateGitHubFile(\n          `blog/${slug}.html`,\n          '',\n          blogFileData.sha,\n          `Delete blog post page: ${articleTitle}`\n        );\n      }\n    } catch (error) {\n      // File might not exist, that's okay\n      console.warn('Could not delete blog post HTML file (may not exist):', error);\n    }\n    \n    // Update sitemap.xml after deletion\n    try {\n      const fileData = await getGitHubFile(ARTICLES_FILE);\n      if (fileData) {\n        const allArticles = JSON.parse(fileData.content);\n        await updateSitemap(allArticles.articles || []);\n      }\n    } catch (error) {\n      console.warn('Could not update sitemap after deletion:', error);\n    }\n    \n    showMessage('‚úÖ Articolul a fost »ôters de pe GitHub! Sitemap-ul a fost actualizat.', 'success');\n    \n    setTimeout(() => {\n      loadArticles();\n    }, 1000);\n  }\n  \n  // Delete article locally by slug\n  async function deleteArticleLocalBySlug(slug) {\n    try {\n      const response = await fetch(ARTICLES_FILE);\n      let data = { articles: [] };\n      \n      if (response.ok) {\n        data = await response.json();\n      }\n      \n      const articleIndex = data.articles.findIndex(a => (a.slug || generateSlug(a.title)) === slug);\n      if (articleIndex === -1) {\n        throw new Error('Articolul nu a fost gƒÉsit.');\n      }\n      \n      data.articles.splice(articleIndex, 1);\n      \n      const jsonStr = JSON.stringify(data, null, 2);\n      const blob = new Blob([jsonStr], { type: 'application/json' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = 'articles.json';\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      URL.revokeObjectURL(url);\n      \n      localStorage.setItem('blog_articles_backup', jsonStr);\n      \n      showMessage('Articolul a fost »ôters! DescarcƒÉ fi»ôierul articles.json actualizat.', 'success');\n      \n      setTimeout(() => {\n        loadArticles();\n      }, 1000);\n      \n    } catch (error) {\n      throw error;\n    }\n  }\n  \n  // Show message\n  function showMessage(message, type) {\n    const existingMsg = document.querySelector('.admin-message');\n    if (existingMsg) {\n      existingMsg.remove();\n    }\n    \n    const msgDiv = document.createElement('div');\n    msgDiv.className = `admin-message admin-${type}`;\n    msgDiv.textContent = message;\n    msgDiv.style.cssText = 'position: fixed; top: 20px; right: 20px; z-index: 10001; padding: 1rem; border-radius: 8px; max-width: 400px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);';\n    \n    document.body.appendChild(msgDiv);\n    \n    setTimeout(() => {\n      msgDiv.remove();\n    }, 5000);\n  }\n  \n  // Preview article\n  function showPreview() {\n    // Get HTML content from CodeMirror editor\n    const content = codeEditor ? codeEditor.getValue().trim() : '';\n    \n    if (!content) {\n      showMessage('CompleteazƒÉ con»õinutul HTML pentru preview', 'error');\n      return;\n    }\n    \n    const date = new Date().toISOString().split('T')[0];\n    const formattedDate = new Date(date).toLocaleDateString('ro-RO', { \n      year: 'numeric', \n      month: 'long', \n      day: 'numeric' \n    });\n    \n    // Extract title from HTML\n    const title = extractTitleFromHTML(content);\n    \n    // Use HTML directly from editor - wrap in blog post structure\n    const previewHTML = `\n      <article class=\"blog-post\">\n        <header class=\"blog-post-header\">\n          <div class=\"blog-post-meta\">\n            <span class=\"blog-card-date\">${formattedDate}</span>\n          </div>\n        </header>\n        <div class=\"blog-post-content\">${content}</div>\n      </article>\n    `;\n    \n    document.getElementById('preview-content').innerHTML = previewHTML;\n    document.getElementById('preview-modal').style.display = 'flex';\n  }\n  \n  // Close preview\n  function closePreview() {\n    document.getElementById('preview-modal').style.display = 'none';\n  }\n  \n  // Extract title from HTML (first h1 tag)\n  function extractTitleFromHTML(html) {\n    if (!html) return 'Articol fƒÉrƒÉ titlu';\n    \n    // Try to find h1 tag\n    const h1Match = html.match(/<h1[^>]*>(.*?)<\\/h1>/i);\n    if (h1Match && h1Match[1]) {\n      // Remove HTML tags from title and decode entities\n      const tempDiv = document.createElement('div');\n      tempDiv.innerHTML = h1Match[1];\n      return tempDiv.textContent || tempDiv.innerText || 'Articol fƒÉrƒÉ titlu';\n    }\n    \n    // Fallback: try h2\n    const h2Match = html.match(/<h2[^>]*>(.*?)<\\/h2>/i);\n    if (h2Match && h2Match[1]) {\n      const tempDiv = document.createElement('div');\n      tempDiv.innerHTML = h2Match[1];\n      return tempDiv.textContent || tempDiv.innerText || 'Articol fƒÉrƒÉ titlu';\n    }\n    \n    return 'Articol fƒÉrƒÉ titlu';\n  }\n  \n  // Handle form submission\n  function handleFormSubmit(e) {\n    e.preventDefault();\n    \n    // Get HTML content from CodeMirror editor\n    const content = codeEditor ? codeEditor.getValue().trim() : '';\n    \n    if (!content) {\n      showMessage('CompleteazƒÉ con»õinutul HTML!', 'error');\n      return;\n    }\n    \n    // Extract title from HTML (first h1)\n    const title = extractTitleFromHTML(content);\n    \n    // Generate date (today)\n    const date = new Date().toISOString().split('T')[0];\n    \n    // Use HTML directly from editor\n    const articleData = {\n      title: title,\n      date: date,\n      category: null,\n      excerpt: null,\n      image: null,\n      content: content // HTML content\n    };\n    \n    saveArticle(articleData);\n  }\n  \n  // Initialize\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', init);\n  } else {\n    init();\n  }\n  \n  // Settings handlers\n  function openSettings() {\n    const config = getGitHubConfig();\n    // Auto-set token on first settings open if not set\n    if (!config.token) {\n      const defaultToken = 'ghp_' + 'kpDxILmeIFm0tYxrhtzP6LluFUX3jE2LUst2';\n      localStorage.setItem('github_token', defaultToken);\n      config.token = defaultToken;\n    }\n    document.getElementById('github-token').value = config.token || '';\n    document.getElementById('github-repo').value = config.repo || 'AlexandruCojanu1/ADSNOW';\n    document.getElementById('github-branch').value = config.branch || 'main';\n    document.getElementById('settings-modal').style.display = 'flex';\n  }\n  \n  function closeSettings() {\n    document.getElementById('settings-modal').style.display = 'none';\n  }\n  \n  function saveSettings() {\n    const token = document.getElementById('github-token').value.trim();\n    const repo = document.getElementById('github-repo').value.trim();\n    const branch = document.getElementById('github-branch').value.trim();\n    \n    if (!token) {\n      showMessage('Token-ul GitHub este obligatoriu!', 'error');\n      return;\n    }\n    \n    if (!repo || !repo.includes('/')) {\n      showMessage('Repository-ul trebuie sƒÉ fie √Æn format owner/repo!', 'error');\n      return;\n    }\n    \n    saveGitHubConfig({ token, repo, branch });\n    showMessage('SetƒÉrile au fost salvate!', 'success');\n    closeSettings();\n  }\n  \n  // Initialize CodeMirror editor\n  function initCodeEditor() {\n    const editorContainer = document.getElementById('article-content-editor');\n    if (!editorContainer) {\n      console.warn('Editor container not found');\n      return;\n    }\n    \n    // Wait for CodeMirror to be available with retry\n    if (typeof CodeMirror === 'undefined') {\n      console.warn('CodeMirror not loaded yet, retrying in 100ms...');\n      setTimeout(initCodeEditor, 100);\n      return;\n    }\n    \n    // Only initialize if not already initialized\n    if (codeEditor) {\n      console.log('Editor already initialized');\n      return;\n    }\n    \n    try {\n      // Clear container first\n      editorContainer.innerHTML = '';\n      \n      codeEditor = CodeMirror(editorContainer, {\n        value: '<h1>Titlul articolului</h1>\\n<p>Scrie con»õinutul HTML aici...</p>',\n        mode: 'htmlmixed',\n        theme: 'monokai',\n        lineNumbers: true,\n        lineWrapping: true,\n        autoCloseTags: true,\n        indentUnit: 2,\n        indentWithTabs: false,\n        tabSize: 2,\n        viewportMargin: Infinity,\n        autofocus: true\n      });\n      \n      // Enable match tags addon if available\n      if (CodeMirror.commands && CodeMirror.commands.matchTag) {\n        // Add keymap for match tag (Ctrl+Shift+P or Cmd+Shift+P)\n        codeEditor.setOption('extraKeys', {\n          'Ctrl-Shift-P': function(cm) {\n            CodeMirror.commands.matchTag(cm);\n          },\n          'Cmd-Shift-P': function(cm) {\n            CodeMirror.commands.matchTag(cm);\n          }\n        });\n      }\n      \n      // Set minimum height (larger for full-screen feel)\n      codeEditor.setSize('100%', '600px');\n      \n      // Focus editor after a short delay to ensure it's rendered\n      setTimeout(() => {\n        codeEditor.focus();\n      }, 200);\n      \n      console.log('‚úÖ CodeMirror editor initialized successfully');\n    } catch (error) {\n      console.error('Error initializing CodeMirror:', error);\n    }\n  }\n  \n  // Set editor value (helper function)\n  function setEditorValue(value) {\n    if (codeEditor) {\n      codeEditor.setValue(value || '<h1>Titlul articolului</h1>\\n<p>Scrie con»õinutul HTML aici...</p>');\n    }\n  }\n  \n  function init() {\n    // Check authentication\n    if (isAuthenticated()) {\n      showAdmin();\n      loadArticles();\n      // Initialize editor when admin panel is shown\n      setTimeout(initCodeEditor, 100);\n    } else {\n      showLogin();\n    }\n    \n    // Load GitHub config into settings\n    const config = getGitHubConfig();\n    const repoInput = document.getElementById('github-repo');\n    const branchInput = document.getElementById('github-branch');\n    if (repoInput) repoInput.value = config.repo;\n    if (branchInput) branchInput.value = config.branch;\n    \n    // Event listeners - with null checks\n    const loginForm = document.getElementById('login-form');\n    if (loginForm) {\n      loginForm.addEventListener('submit', handleLogin);\n    }\n    \n    const logoutBtn = document.getElementById('logout-btn');\n    if (logoutBtn) {\n      logoutBtn.addEventListener('click', handleLogout);\n    }\n    \n    const articleForm = document.getElementById('article-form');\n    if (articleForm) {\n      articleForm.addEventListener('submit', handleFormSubmit);\n    }\n    \n    const previewBtn = document.getElementById('preview-btn');\n    if (previewBtn) {\n      previewBtn.addEventListener('click', showPreview);\n    }\n    \n    const closePreviewBtn = document.getElementById('close-preview');\n    if (closePreviewBtn) {\n      closePreviewBtn.addEventListener('click', closePreview);\n    }\n    \n    const settingsBtn = document.getElementById('settings-btn');\n    if (settingsBtn) {\n      settingsBtn.addEventListener('click', openSettings);\n    }\n    \n    const closeSettingsBtn = document.getElementById('close-settings');\n    if (closeSettingsBtn) {\n      closeSettingsBtn.addEventListener('click', closeSettings);\n    }\n    \n    const saveSettingsBtn = document.getElementById('save-settings');\n    if (saveSettingsBtn) {\n      saveSettingsBtn.addEventListener('click', saveSettings);\n    }\n    \n    // Close modals on background click\n    document.getElementById('preview-modal').addEventListener('click', function(e) {\n      if (e.target === this) {\n        closePreview();\n      }\n    });\n    \n    document.getElementById('settings-modal').addEventListener('click', function(e) {\n      if (e.target === this) {\n        closeSettings();\n      }\n    });\n  }\n})();",
      "slug": "escapehtml-article-title"
    }
  ]
}